<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <app-sidebar-toggle></app-sidebar-toggle>
    </ion-buttons>
    <ion-title>Challenges</ion-title>
    <ion-buttons slot="end" *ngIf="user">
      <ion-button (click)="createChallenge()">
        <ion-icon slot="icon-only" name="add"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="challenges-container">
    <div class="header-section">
      <h2>Current Challenges</h2>
      <p *ngIf="!user" class="sign-in-prompt">
        <a (click)="openLoginModal()">Sign in</a> to create and participate in challenges.
      </p>
    </div>

    <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

    <div *ngIf="!isLoading && challenges.length === 0" class="empty-state">
      <ion-icon name="trophy-outline"></ion-icon>
      <h3>No challenges yet</h3>
      <p *ngIf="user">Be the first to create a challenge!</p>
      <p *ngIf="!user">Sign in to create the first challenge.</p>
    </div>

    <div *ngIf="!isLoading && challenges.length > 0" class="challenges-list">
      <ion-card *ngFor="let challenge of challenges" class="challenge-card">
        <ion-card-header>
          <div class="card-header-row">
            <div class="card-title-section">
              <ion-card-title>{{ challenge.name }}</ion-card-title>
              <ion-card-subtitle>{{ getDateRange(challenge) }}</ion-card-subtitle>
            </div>
            <ion-button
              *ngIf="isOwner(challenge)"
              fill="clear"
              size="small"
              (click)="editChallenge(challenge)"
              class="edit-button">
              <ion-icon slot="icon-only" name="create-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-card-header>
        <ion-card-content>
          <p class="description">{{ challenge.description }}</p>
          <div class="challenge-details">
            <div class="detail-item">
              <ion-icon name="stats-chart-outline"></ion-icon>
              <span><strong>Tracking:</strong> {{ getMetricsList(challenge) }}</span>
            </div>
            <div class="detail-item">
              <ion-icon name="swap-vertical-outline"></ion-icon>
              <span><strong>Sort by:</strong> {{ getSortByLabel(challenge) }}</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>