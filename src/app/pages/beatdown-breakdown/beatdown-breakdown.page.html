<ion-content class="ion-no-padding" [class.no-scroll]="!user || !wrappedData">
  <!-- Wrapped data slides -->
  <div class="wrapped-slides" #slidesContainer>
    <!-- Intro slide (first slide, shown for all users) -->
    <div class="intro-slide-in-slides" [class.email-shown]="showEmailInput && !user" #introSlideElement>
      <div class="title-section">
        <p class="subtitle">Your {{year}}</p>
        <h1>Beatdown Breakdown</h1>
      </div>

      <!-- Email input form (shown when user clicks "Let's Roll" and is not authenticated) -->
      <div class="email-input-section" [class.visible]="showEmailInput && !user">
        <p class="email-prompt">Enter your F3 email address</p>
        <p class="slack-email-note">Please use the same email address you use for Slack.</p>
        <ion-item class="email-input-item">
          <ion-input
            #emailInput
            type="email"
            [(ngModel)]="email"
            placeholder="your.email@example.com"
            [disabled]="isSendingEmail">
          </ion-input>
        </ion-item>
        <ion-button
          expand="block"
          size="large"
          (click)="sendLoginLink()"
          [disabled]="isSendingEmail || !email"
          class="send-link-button">
          <ion-spinner *ngIf="isSendingEmail" name="crescent"></ion-spinner>
          <span *ngIf="!isSendingEmail">Send Sign-In Link</span>
        </ion-button>
        <p class="help-text">You'll receive an email with a link to sign in. No password required!</p>
      </div>

      <!-- Let's Roll button (shown when email input is not visible) -->
      <div class="action-section" [class.hidden]="showEmailInput && !user">
        <ion-button
          expand="block"
          size="large"
          (click)="onLetsRoll()"
          class="lets-roll-button">
          Let's Roll
        </ion-button>
      </div>
      <app-slide-chevron [slideElement]="introSlideElement"></app-slide-chevron>
    </div>

    <!-- Data slides (only shown when wrappedData exists) -->
    <ng-container *ngIf="wrappedData">
      <!-- Total posts -->
      <app-stat-card
        eyebrow="YOU POSTED"
        [bigStat]="wrappedData.totalPosts"
        [statLabel]="'TIMES IN ' + wrappedData.year"
        [description]="getTotalPostsDescription()"
        [photoUrl]="wrappedData.paxPhotoUrl"
        [paxName]="wrappedData.paxName"
        [hugeStat]="true"
        [animateCount]="true"
        backgroundGradient="linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)"
        decorationIcon="">
      </app-stat-card>

      <!-- Narrative: Showing Up -->
      <app-narrative-slide
        message="Q Source tells us that disruption is the foundation."
        leadIn="Your bed wanted you to stay, how often were you able to skip the snooze button?"
        imageUrl="/assets/disruption.webp"
        backgroundGradient="linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)">
      </app-narrative-slide>

      <!-- Combined breakdown -->
      <app-combined-breakdown
        [monthlyData]="wrappedData.monthlyBreakdown"
        [dayData]="wrappedData.dayOfWeekBreakdown"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-combined-breakdown>

      <!-- Narrative: Preparedness -->
      <app-narrative-slide
        message="F3 is a leadership movement, not just a workout group. Preparedness is developed through small, difficult, daily actions."
        leadIn="How did you prepare yourself?"
        imageUrl="/assets/preparedness.webp"
        backgroundGradient="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
      </app-narrative-slide>

      <!-- Workout Type Breakdown -->
      <app-workout-type-breakdown
        *ngIf="wrappedData.workoutTypeBreakdown.length > 0"
        [workoutTypes]="wrappedData.workoutTypeBreakdown"
        backgroundGradient="linear-gradient(139deg, #609a69 0%, rgb(28 15 40) 100%)">
      </app-workout-type-breakdown>

      <!-- Narrative: Sharpening -->
      <app-narrative-slide
        *ngIf="wrappedData.workoutTypeBreakdown.length > 0"
        title="Q1.8: WHETSTONE"
        message="Men become effective through intentional sharpening, not isolation. Men sharpen each other in close proximity."
        leadIn="Where was this for you?"
        imageUrl="/assets/whetstone.webp"
        backgroundGradient="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
      </app-narrative-slide>

      <!-- Top AOs Breakdown -->
      <app-top-aos-breakdown
        *ngIf="wrappedData.topAOs.length > 0"
        [topAOs]="wrappedData.topAOs"
        backgroundGradient="linear-gradient(135deg, rgb(11 55 28) 0%, rgb(88 108 93) 100%)">
      </app-top-aos-breakdown>

      <!-- Top AO -->
      <app-home-base
        [aoName]="wrappedData.topAO.name"
        [posts]="wrappedData.topAO.posts"
        [percentage]="wrappedData.topAO.percentage"
        [description]="getTopAODescription()"
        [address]="wrappedData.topAO.address"
        [mapLocationUrl]="wrappedData.topAO.map_location_url"
        [consistencyRate]="wrappedData.topAO.consistencyRate"
        [possibleSlots]="wrappedData.topAO.possibleSlots"
        backgroundGradient="linear-gradient(135deg, #2c1810 0%, #3d2817 100%)">
      </app-home-base>

      <!-- Narrative: Home Base -->
      <app-narrative-slide
        message="This AO became your Group. It's where you found Shield Lock. Where you built Mutual Competence with the men beside you."
        imageUrl="/assets/group.webp"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #2d1b3d 100%)">
      </app-narrative-slide>


      <!-- Regional Growth Stats -->
      <app-regional-growth-stats
        *ngIf="wrappedData.regionalGrowthStats"
        [region]="wrappedData.regionalGrowthStats.region"
        [totalBDs]="wrappedData.regionalGrowthStats.totalBDs"
        [totalPax]="wrappedData.regionalGrowthStats.totalPax"
        [totalAOs]="wrappedData.regionalGrowthStats.totalAOs"
        [newAOs]="wrappedData.regionalGrowthStats.newAOs"
        [totalFNGs]="wrappedData.regionalGrowthStats.totalFNGs"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-regional-growth-stats>

      <!-- Regional Nantan Video -->
      <app-video-slide
        *ngIf="getRegionalVideoPath()"
        [videoSrc]="getRegionalVideoPath()!"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)"
        (videoEnded)="onVideoEnded()">
      </app-video-slide>

      <!-- PAX Network -->
      <app-pax-network
        [totalPax]="wrappedData.paxNetwork.totalPaxEncountered"
        [workoutBuddies]="wrappedData.paxNetwork.topWorkoutBuddies"
        backgroundGradient="linear-gradient(135deg, #1a2332 0%, #2d3a4f 100%)">
      </app-pax-network>

      <!-- Narrative: Shield Lock -->
      <app-narrative-slide
        message="We don't show up at F3 for ourselves. We show up for the man standing beside each of us."
        leadIn="Who stuck by your side all year?"
        imageUrl="/assets/shield-lock.webp"
        backgroundGradient="linear-gradient(135deg, rgb(57 47 41) 0%, rgb(255 0 0 / 76%) 100%)">
      </app-narrative-slide>

      <!-- Bestie Guess -->
      <app-bestie-guess
        *ngIf="wrappedData.paxNetwork.topWorkoutBuddies && wrappedData.paxNetwork.topWorkoutBuddies.length >= 3"
        [workoutBuddies]="wrappedData.paxNetwork.topWorkoutBuddies"
        backgroundGradient="linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)"
        (guessComplete)="onBestieGuessComplete()">
      </app-bestie-guess>

      <!-- Bestie -->
      <app-stat-card
        *ngIf="wrappedData.paxNetwork.topWorkoutBuddies && wrappedData.paxNetwork.topWorkoutBuddies.length > 0"
        [photoUrl]="bestiePhotoUrl"
        eyebrow="YOUR BESTIE"
        [paxName]="wrappedData.paxNetwork.topWorkoutBuddies[0].name"
        [bigStat]="wrappedData.paxNetwork.topWorkoutBuddies[0].posts"
        statLabel="BDs together"
        [description]="getBestieDescription()"
        [hugeStat]="true"
        [animateCount]="true"
        backgroundGradient="linear-gradient(135deg, #1e3a5f 0%, #2d4a7a 100%)">
      </app-stat-card>

      <!-- Narrative: Leadership -->
      <app-narrative-slide
        message="F3 is peer-led in a rotating fashion. When you take the Q, you're investing in your brothers, helping them get 1% better every day."
        leadIn="How many times did you lead?"
        imageUrl="/assets/lead-right.webp"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-narrative-slide>

      <!-- Q Stats -->
      <app-leadership-impact
        *ngIf="wrappedData.qStats"
        eyebrow="LEADERSHIP IMPACT"
        [bigStat]="wrappedData.qStats.timesAsQ"
        statLabel="TIMES AS Q"
        [animateCount]="true"
        [description]="getQStatsDescription()"
        [callouts]="qCallouts"
        [simpleCallout]="getQCallout()"
        [favoriteAOToLead]="wrappedData.qStats.favoriteAOToLead"
        [paxName]="wrappedData.paxName"
        [qCountMaps]="wrappedData.qStats.qCountMaps"
        backgroundGradient="linear-gradient(135deg, #1e2329 0%, #2a2f35 100%)">
      </app-leadership-impact>

      <!-- Streaks -->
      <app-streaks
        *ngIf="wrappedData.streaks"
        [longestStreak]="wrappedData.streaks.longestStreak"
        [longestStreakStart]="wrappedData.streaks.longestStreakStart"
        [longestStreakEnd]="wrappedData.streaks.longestStreakEnd"
        [yearActiveWeeks]="wrappedData.streaks.yearActiveWeeks"
        [yearTotalWeeks]="wrappedData.streaks.yearTotalWeeks"
        [yearActivePercentage]="wrappedData.streaks.yearActivePercentage"
        [weeklyData]="wrappedData.streaks.weeklyData"
        [year]="wrappedData.year"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)">
      </app-streaks>

      <!-- Narrative: Consistency -->
      <app-narrative-slide
        message="Consistency builds trust. Keep showing up for the man next to you."
        leadIn="How much total time did you spend in the gloom?"
        imageUrl="/assets/consistency.webp"
        backgroundGradient="linear-gradient(135deg, #1a1625 0%, #2d1f3d 100%)">
      </app-narrative-slide>

      <!-- Total Minutes in Gloom -->
      <app-stat-card
        eyebrow="TIME IN THE GLOOM"
        [bigStat]="formatMinutes(wrappedData.totalMinutesInGloom)"
        statLabel="MINUTES"
        [description]="getMinutesDescription()"
        [callout]="getMinutesCallout()"
        [animateClock]="true"
        [clockMinutes]="wrappedData.totalMinutesInGloom"
        leadIn='And remember ðŸ‘‡'
        [hugeStat]="true"
        backgroundGradient="linear-gradient(135deg, rgb(15 37 87) 0%, rgb(98 88 98) 100%)"
        decorationIcon="">
      </app-stat-card>

      <!-- You vs You Comparison (includes video) -->
      <app-you-vs-you
        [currentYear]="wrappedData.year"
        [previousYear]="wrappedData.comparisonStats?.previousYear || wrappedData.year - 1"
        [totalPosts]="getComparisonTotalPosts()"
        [totalMinutes]="getComparisonTotalMinutes()"
        [timesAsQ]="getComparisonTimesAsQ()"
        [totalPaxEncountered]="getComparisonTotalPaxEncountered()"
        [paxName]="wrappedData.paxName"
        [paxPhotoUrl]="wrappedData.paxPhotoUrl"
        [isFirstYear]="wrappedData.isFirstYear"
        [videoSrc]="getOnly40MoreMinutesVideoPath()"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-you-vs-you>

    </ng-container>
  </div>


  <ion-fab class="close-fab-container" slot="fixed" vertical="top" horizontal="start">
    <ion-fab-button (click)="goToHome()" class="close-fab">
      <ion-icon name="close"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
