<ion-content class="ion-no-padding" [class.no-scroll]="!user || !wrappedData">
  <!-- Wrapped data slides -->
  <div class="wrapped-slides" #slidesContainer>
    <!-- Intro slide (first slide, shown for all users) -->
    <div class="intro-slide-in-slides" [class.email-shown]="showEmailInput && !user" #introSlideElement>
      <div class="title-section">
        <p class="subtitle">Your {{year}}</p>
        <h1>Beatdown Breakdown</h1>
      </div>

      <!-- Email input form (shown when user clicks "Let's Roll" and is not authenticated) -->
      <div class="email-input-section" [class.visible]="showEmailInput && !user">
        <p class="email-prompt">Enter your F3 email address</p>
        <p class="slack-email-note">Please use the same email address you use for Slack.</p>
        <ion-item class="email-input-item">
          <ion-input
            #emailInput
            type="email"
            [(ngModel)]="email"
            placeholder="your.email@example.com"
            [disabled]="isSendingEmail">
          </ion-input>
        </ion-item>
        <ion-button
          expand="block"
          size="large"
          (click)="sendLoginLink()"
          [disabled]="isSendingEmail || !email"
          class="send-link-button">
          <ion-spinner *ngIf="isSendingEmail" name="crescent"></ion-spinner>
          <span *ngIf="!isSendingEmail">Send Sign-In Link</span>
        </ion-button>
        <p class="help-text">You'll receive an email with a link to sign in. No password required!</p>
      </div>

      <!-- Let's Roll button (shown when email input is not visible) -->
      <div class="action-section" [class.hidden]="showEmailInput && !user">
        <ion-button
          expand="block"
          size="large"
          (click)="onLetsRoll()"
          class="lets-roll-button">
          Let's Roll
        </ion-button>
      </div>
      <app-slide-chevron [slideElement]="introSlideElement"></app-slide-chevron>
    </div>

    <!-- Data slides (only shown when wrappedData exists) -->
    <ng-container *ngIf="wrappedData">
      <!-- Total posts -->
      <app-stat-card
        eyebrow="YOU POSTED"
        [bigStat]="wrappedData.totalPosts"
        [statLabel]="'TIMES IN ' + wrappedData.year"
        [description]="getTotalPostsDescription()"
        [photoUrl]="wrappedData.paxPhotoUrl"
        [paxName]="wrappedData.paxName"
        [hugeStat]="true"
        backgroundGradient="linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)"
        decorationIcon="">
      </app-stat-card>

      <!-- Narrative: Showing Up -->
      <app-narrative-slide
        title="DISRUPTION"
        message="Q Source tells us that disruption is the foundation."
        leadIn="Your bed wanted you to stay, how often were you able to skip the snooze button?"
        imageUrl="/assets/disruption.webp"
        backgroundGradient="linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)">
      </app-narrative-slide>

      <!-- Combined breakdown -->
      <app-combined-breakdown
        [monthlyData]="wrappedData.monthlyBreakdown"
        [dayData]="wrappedData.dayOfWeekBreakdown"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-combined-breakdown>

      <!-- Narrative: Preparedness -->
      <app-narrative-slide
        title="PREPAREDNESS"
        message="F3 is a leadership movement, not just a workout group. Preparedness is developed through small, difficult, daily actions."
        leadIn="How did you prepare yourself?"
        imageUrl="/assets/preparedness.webp"
        backgroundGradient="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
      </app-narrative-slide>

      <!-- Workout Type Breakdown -->
      <app-workout-type-breakdown
        *ngIf="wrappedData.workoutTypeBreakdown.length > 0"
        [workoutTypes]="wrappedData.workoutTypeBreakdown"
        backgroundGradient="linear-gradient(139deg, #609a69 0%, rgb(28 15 40) 100%)">
      </app-workout-type-breakdown>

      <!-- Narrative: Pushing Limits -->
      <app-narrative-slide
        *ngIf="wrappedData.workoutTypeBreakdown.length > 0"
        title="Q1.8: WHETSTONE"
        message="Men become effective through intentional sharpening, not isolation. In sharpening another man, a leader sharpens himself."
        leadIn="Where was this for you?"
        imageUrl="/assets/whetstone.webp"
        backgroundGradient="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
      </app-narrative-slide>

      <!-- Top AOs Breakdown -->
      <app-top-aos-breakdown
        *ngIf="wrappedData.topAOs.length > 0"
        [topAOs]="wrappedData.topAOs"
        backgroundGradient="linear-gradient(135deg, rgb(11 55 28) 0%, rgb(88 108 93) 100%)">
      </app-top-aos-breakdown>

      <!-- Narrative: Home Base -->
      <app-narrative-slide
        title="F3: THE GROUP"
        message="This AO became your Group. It's where you found Shield Lock. Where you built Mutual Competence with the men beside you."
        imageUrl="/assets/group.webp"
        backgroundGradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)">
      </app-narrative-slide>

      <!-- Top AO -->
      <app-home-base
        [aoName]="wrappedData.topAO.name"
        [posts]="wrappedData.topAO.posts"
        [percentage]="wrappedData.topAO.percentage"
        [description]="getTopAODescription()"
        [address]="wrappedData.topAO.address"
        [mapLocationUrl]="wrappedData.topAO.map_location_url"
        [consistencyRate]="wrappedData.topAO.consistencyRate"
        [possibleSlots]="wrappedData.topAO.possibleSlots"
        backgroundGradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)">
      </app-home-base>

      <!-- Narrative: Regional Leadership -->
      <app-narrative-slide
        *ngIf="getRegionalVideoPath()"
        title="REGIONAL LEADERSHIP"
        message="Your region's Nantan has a message for you."
        imageUrl="/assets/consistency.webp"
        backgroundGradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)">
      </app-narrative-slide>

      <!-- Regional Nantan Video -->
      <app-video-slide
        *ngIf="getRegionalVideoPath()"
        [videoSrc]="getRegionalVideoPath()!"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)"
        (videoEnded)="onVideoEnded()">
      </app-video-slide>

      <!-- PAX Network -->
      <app-pax-network
        [totalPax]="wrappedData.paxNetwork.totalPaxEncountered"
        [workoutBuddies]="wrappedData.paxNetwork.topWorkoutBuddies"
        backgroundGradient="linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)">
      </app-pax-network>

      <!-- Narrative: Fellowship -->
      <app-narrative-slide
        title="Q1.7: SHIELD LOCK"
        message="We don't show up at F3 for ourselves. We show up for the man standing beside each of us. Who stuck by your side all year?"
        imageUrl="/assets/shield-lock.webp"
        backgroundGradient="linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)">
      </app-narrative-slide>

      <!-- Bestie -->
      <app-stat-card
        *ngIf="wrappedData.paxNetwork.topWorkoutBuddies && wrappedData.paxNetwork.topWorkoutBuddies.length > 0"
        [photoUrl]="bestiePhotoUrl"
        eyebrow="YOUR BESTIE"
        [paxName]="wrappedData.paxNetwork.topWorkoutBuddies[0].name"
        [bigStat]="wrappedData.paxNetwork.topWorkoutBuddies[0].posts"
        statLabel="BDs together"
        [description]="getBestieDescription()"
        [hugeStat]="true"
        backgroundGradient="linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)">
      </app-stat-card>

      <!-- Narrative: Leadership -->
      <app-narrative-slide
        title="Q3.1: SHARED LEADERSHIP"
        message="When you Q'd, you practiced Shared Leadership. You showed up early. You planned the beatdown. You invested in others. How many times did you lead?"
        imageUrl="/assets/lead-right.webp"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
      </app-narrative-slide>

      <!-- Q Stats -->
      <app-leadership-impact
        *ngIf="wrappedData.qStats"
        eyebrow="LEADERSHIP IMPACT"
        [bigStat]="wrappedData.qStats.timesAsQ"
        statLabel="TIMES AS Q"
        [description]="getQStatsDescription()"
        [callouts]="qCallouts"
        [qCountMaps]="wrappedData.qStats.qCountMaps"
        backgroundGradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)">
      </app-leadership-impact>

      <!-- Narrative: Consistency -->
      <app-narrative-slide
        title="Q3.10: CONSISTENCY"
        message="Consistency builds trust. Your brothers need to know they can count on you. How many weeks were you active?"
        imageUrl="/assets/consistency.webp"
        backgroundGradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)">
      </app-narrative-slide>

      <!-- Streaks -->
      <app-streaks
        *ngIf="wrappedData.streaks"
        [longestStreak]="wrappedData.streaks.longestStreak"
        [longestStreakStart]="wrappedData.streaks.longestStreakStart"
        [longestStreakEnd]="wrappedData.streaks.longestStreakEnd"
        [yearActiveWeeks]="wrappedData.streaks.yearActiveWeeks"
        [yearTotalWeeks]="wrappedData.streaks.yearTotalWeeks"
        [yearActivePercentage]="wrappedData.streaks.yearActivePercentage"
        [weeklyData]="wrappedData.streaks.weeklyData"
        [year]="wrappedData.year"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)">
      </app-streaks>

      <!-- Total Minutes in Gloom -->
      <app-stat-card
        eyebrow="TIME IN THE GLOOM"
        [bigStat]="formatMinutes(wrappedData.totalMinutesInGloom)"
        statLabel="MINUTES"
        [description]="getMinutesDescription()"
        [callout]="getMinutesCallout()"
        leadIn='And remember ðŸ‘‡'
        [hugeStat]="true"
        backgroundGradient="linear-gradient(135deg, rgb(15 37 87) 0%, rgb(98 88 98) 100%)"
        decorationIcon="">
      </app-stat-card>

      <!-- Only 40 More Minutes Video -->
      <app-video-slide
        [videoSrc]="getOnly40MoreMinutesVideoPath()"
        backgroundGradient="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)"
        (videoEnded)="onVideoEnded()">
      </app-video-slide>

    </ng-container>
  </div>


  <ion-fab class="close-fab-container" slot="fixed" vertical="top" horizontal="start">
    <ion-fab-button (click)="goToHome()" class="close-fab">
      <ion-icon name="close"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
