<!-- Overlay for mobile -->
<div class="sidebar-overlay" *ngIf="isOpen && isMobile && !shouldHide" (click)="close()"></div>

<!-- Sidebar -->
<div class="sidebar" [class.open]="isOpen" [class.desktop-open]="!isMobile" [class.hidden]="shouldHide">
  <!-- Close button for mobile -->
  <div class="sidebar-header">
    <ion-button fill="clear" class="close-button" (click)="close()" *ngIf="isMobile">
      <ion-icon slot="icon-only" name="close"></ion-icon>
    </ion-button>
  </div>

  <!-- Scrollable content wrapper -->
  <div class="sidebar-scrollable">
    <!-- Regions Section -->
    <div class="sidebar-content">
    <!-- Navigation Items -->
    <div class="sidebar-section">
      <!-- All Stats -->
      <button
        type="button"
        class="nav-link"
        [class.active]="allStatsItem.isActive"
        (click)="navigate(allStatsItem.route)">
        {{ allStatsItem.label }}
      </button>
      <!-- Double Downs link styled like AOs -->
      <button
        type="button"
        class="ao-link"
        style="padding-left: 40px;"
        [class.active]="doubleDownsActive"
        (click)="navigate('/dd/all')">
        Double Downs
      </button>
      <!-- Other navigation items -->
      <button
        type="button"
        class="nav-link"
        *ngFor="let item of otherNavigationItems"
        [class.active]="item.isActive"
        (click)="navigate(item.route)">
        {{ item.label }}
      </button>
    </div>

    <!-- Regions Section -->
    <div class="sidebar-section" *ngFor="let region of regions">
      <div class="region-header">
        <button
          type="button"
          class="region-link"
          [class.active]="region.isActive"
          (click)="navigate(region.route)">
          {{ region.name }}
        </button>
        <ion-button
          fill="clear"
          class="collapse-toggle"
          (click)="toggleRegionCollapse(region, $event)">
          <ion-icon
            [name]="region.collapsed ? 'chevron-down' : 'chevron-up'"
            slot="icon-only">
          </ion-icon>
        </ion-button>
      </div>
      <div class="ao-list" [class.collapsed]="region.collapsed">
        <button
          type="button"
          class="ao-link"
          *ngFor="let ao of region.aos"
          [class.active]="ao.isActive"
          (click)="navigate('/ao/' + ao.name)">
          {{ ao.normalizedName }}
        </button>
      </div>
    </div>

    <!-- Other AO Sections (Region Agnostic and Discontinued) -->
    <div class="sidebar-section" *ngFor="let section of otherAOSections">
      <div class="region-header">
        <button
          type="button"
          class="region-link other-ao-section"
          disabled>
          {{ section.title }}
        </button>
        <ion-button
          fill="clear"
          class="collapse-toggle"
          (click)="toggleOtherAOSectionCollapse(section, $event)">
          <ion-icon
            [name]="section.collapsed ? 'chevron-down' : 'chevron-up'"
            slot="icon-only">
          </ion-icon>
        </ion-button>
      </div>
      <div class="ao-list" [class.collapsed]="section.collapsed">
        <button
          type="button"
          class="ao-link"
          *ngFor="let ao of section.aos"
          [class.active]="ao.isActive"
          (click)="navigate('/ao/' + ao.name)">
          {{ ao.normalizedName }}
        </button>
      </div>
    </div>

    <div class="sidebar-section">
      <ion-button
        color="light"
        fill="clear"
        (click)="navigate('/')">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
        Back to the main site
      </ion-button>
    </div>
    </div>
  </div>

  <!-- Fixed Footer with Auth Button/User Info -->
  <div class="sidebar-footer">
    <app-auth-button></app-auth-button>
  </div>
</div>